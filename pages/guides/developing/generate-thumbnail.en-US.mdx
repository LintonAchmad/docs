---
title: 'Generate thumbnail for assets'
description: 'Learn how to generate thumbnails for your assets on the server side using Node.js and Python.'
---

import { Callout } from 'nextra-theme-docs';

# Generate thumbnail for assets

Thumbnails can be created on the front-end or on the server side of an application. In this guide, you will learn how to generate video thumbnails on the frontend as well as on the server side.

<Callout>
  While it is possible to generate thumbnails on the front-end, it is generally
  more resource-intensive and may not be suitable for larger videos. Therefore,
  it is often recommended to generate thumbnails on the server side.
</Callout>

## Frontend

In this guide, we will be using HTML canvas in a Next.js application to generate thumbnails.

#### Set up a Next.js project

This guide assumes that you already have Next.js and Livepeer.js setup. If you haven't already, you can follow the [Getting started](/reference/livepeer-js/getting-started) guide to set up a Next.js project with Livepeer.js.

Once you have a Next.js project setup, remove the code inside `pages/index.js` file and replace it with the following code:

```jsx
import { Player } from '@livepeer/react';
import { useRef, useState, useEffect } from 'react';

export default function Home() {
  const canvasRef = useRef();
  const [dimensions, setDimensions] = useState();
  const [videoRef, setVideoRef] = useState();

  return (
    <div
      style={{
        width: '40%',
      }}
    >
      <Player
        title="Agent 327: Operation Barbershop"
        playbackId="6d7el73r1y12chxr"
        showPipButton
        objectFit="cover"
        mediaElementRef={video}
        priority
      />
    </div>
  );
}
```

In the above code, we are using the `Player` component from Livepeer.js to play the video. The `mediaElementRef` prop is used to get a reference to the video element. We will use this reference to generate a thumbnail.

If you run the app now, you should see a video player on the page.
![Image](/images/thumbnail/6.png)

#### Generate thumbnail

Next, we need to calculate the dimensions of the video element. To do this, we will use the `useEffect` hook to get the dimensions of the video element and store them in the `dimensions` state variable.

```jsx
useEffect(() => {
  const handleMetadata = () => {
    setDimensions({
      width: videoRef.videoWidth,
      height: videoRef.videoHeight,
    });
  };
  if (videoRef) {
    videoRef.addEventListener('loadedmetadata', handleMetadata);
    return () => videoRef.removeEventListener('loadedmetadata', handleMetadata);
  }
}, [videoRef]);
```

The above code will run whenever the `videoRef` state variable changes. It will add an event listener to the video element and calculate the dimensions of the video element. The dimensions are then stored in the `dimensions` state variable.

Next, we need to create a function that will generate a thumbnail. To do this, we will use the `canvasRef` state variable to get a reference to the canvas element. Then, we will use the `drawImage` method to draw the video element on the canvas element.

```jsx
const takeScreenShot = () => {
  if (!dimensions) return;
  const ctx = canvasRef.current.getContext('2d');
  canvasRef.current.width = dimensions.width;
  canvasRef.current.height = dimensions.height;
  ctx.drawImage(videoRef, 0, 0, dimensions.width, dimensions.height);
};
```

The above code will run whenever the `takeScreenShot` function is called. It will draw the video element on the canvas element.

Finally, we need to call the `takeScreenShot` function whenever the video element is paused. To do this, add a button to the page and add an `onClick` handler to it.

```jsx
<button onClick={takeScreenShot}>Take screenshot</button>
```

You also need to add a `canvas` element to the page. The `canvas` element will be used to display the thumbnail.

```jsx
<canvas crossOrigin="anonymous" ref={canvas} />
```

If you run the app now, you should see a video player on the page with a button to generate a thumbnail. Click on the button, you should see a thumbnail of the video.

![Image](/images/thumbnail/7.png)

<Callout>
  In order to post this thumbnail to your backend server, or storage provider,
  you will need to convert it to a base64 string. You can use the
  [toDataURL](https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL)
  method to do this.
</Callout>

## Backend

In this guide, we will be using Node.js to generate thumbnails. But the proccess should be similar for any other backend language. Generating thumbnails for your assets with node.js is pretty easy. We will be using a FFmpeg package which is very straightforward and easy.

#### Set up a node project

The first step is to setup a node.js project. Open your terminal and run the following command.

```jsx
 mkdir server && cd server && npm init -y
```

This command will create a new directory called `server` and initialize a Node.js project inside of it. Next, we need to install a few dependencies to our application. Go ahead and run the below command to install `express` and `ffmpeg`.

```jsx
npm install express fluent-ffmpeg
```

`express` is a popular web framework for node.js that makes it easy to build web applications and APIs.
`ffmpeg` is a powerful too for working with video/audio file.

#### Generate thumbnails

Now that you have installed the necessary dependencies, it is time to create a REST API that can be used to generate thumbnails for your assets. To do this, you will need to create a new file called **`index.js`** in the root directory of your project and add the following code to it:

```jsx
const express = require('express');
const app = express();
// set port
const port = 3000;

// define a route handler for the generate-thumbnail endpoint
app.get('/generate-thumbnail', (req, res) => {
  // send back a response
  res.send('Hello World!');
});

// start the express server
app.listen(port, () => {
  console.log(`server listening on port ${port}`);
});
```

The above code is a simple node application that listens for a GET request at the endpoint `/generate-thumbnail`. To start the app, simply run `node index.js`
in your terminal and then navigate to [http://localhost:3000/generate-thumbnail](http://localhost:3000/generate-thumbnail)
in your browser. If the app is running correctly, you should see the message "Hello World!" displayed in the browser.

To generate a thumbnail using FFmpeg, you will need to import the package at the top of your `index.js` file like this:

```jsx
const ffmpeg = require('fluent-ffmpeg');
```

Finally, update update the `/generate-thumbnail`route with the following code:

```jsx
app.get('/generate-thumbnail', (req, res) => {
  // get video link from req.query
  const { url } = req.query;

  // generate thumbnail
  ffmpeg(url)
    .FPS(1) // frame per second
    .screenshots({
      timestamps: ['1'], // take a screenshot at 1 second
      filename: 'thumbnail.jpg', // name of the generated thumbnail
      size: '1280x720', // size of the generated thumbnail
      duration: 1, // duration of the video
    })
    .on('error', console.error) // handle errors
    .on('end', () => {
      // send back a response
      res.send('Screenshot taken');
    });
});
```

In the above code, we are using FFmpeg to generate a thumbnail from the first second of the video, which is specified using the `timestamps` parameter. The thumbnail will be saved as a file named "thumbnail.jpg" with a resolution of 1280x720.

The `on` method is used to handle any errors or to send a response when the
thumbnail has been successfully generated.

To test your thumbnail generation API, you will need to restart the server for your Node.js app and navigate to the following URL in your web browser:

```txt
http://localhost:3000/generate-thumbnail?url=https://lp-playback.com/hls/6689x2884egm65ti/index.m3u8
```

Be sure to replace the video URL with the actual playback URL for your video, which you can find in the Livepeer Studio dashboard. Once you have entered the correct URL, the API should generate a thumbnail for the specified video and send a response “Screenshot taken”

>

<Callout>
  If you encounter any errors or issues, you can check the console output for
  more information.
</Callout>
![Screenshot-Taken](/images/thumbnail/1.png)

Go to your project directory and you should be able to see `thumbnail.jpg`. These thumbnails can also be saved on S3, IPFS and Arweave.

![Image](/images/thumbnail/2.png)

#### Generate multiple thumbnails

To generate multiple thumbnails at different time frames, just replace the FFmpeg function with the below code,

```jsx
ffmpeg(url)
  .screenshots({
    timestamps: ['1', '2', '3'], // take a screenshot at 1, 2 and 3 seconds
    filename: 'thumbnail-at-%s-seconds.png', // name of the generated thumbnail
    size: '1280x720 ', // size of the generated thumbnail
    duration: 5, // duration of the video
  })
  .on('error', console.error) // handle errors
  .on('end', () => {
    // send back a response
    res.send('Screenshot taken');
  });
```

If you send a request to API, you should now be able to see multiple thumbnails.

![Multiple-Image](/images/thumbnail/3.png)
